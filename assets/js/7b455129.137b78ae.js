"use strict";(self.webpackChunkminetrax_github_io=self.webpackChunkminetrax_github_io||[]).push([[1468],{6867:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"web/websocket-options","title":"WebSocket Options","description":"It is recommended you keep running Pusher and switch to alternative methods only if Pusher free plan doesn\'t meet your needs.","source":"@site/docs/web/websocket-options.md","sourceDirName":"web","slug":"/web/websocket-options","permalink":"/docs/web/websocket-options","draft":false,"unlisted":false,"editUrl":"https://github.com/minetrax/minetrax.github.io/edit/main/docs/web/websocket-options.md","tags":[],"version":"current","sidebarPosition":90,"frontMatter":{"sidebar_position":90,"title":"WebSocket Options","id":"websocket-options"},"sidebar":"tutorialSidebar","previous":{"title":"Console Commands","permalink":"/docs/web/console-commands"},"next":{"title":"Backup Site","permalink":"/docs/web/backup"}}');var r=n(4848),o=n(8453);const i={sidebar_position:90,title:"WebSocket Options",id:"websocket-options"},a=void 0,c={},d=[{value:"Laravel Websockets",id:"laravel-websockets",level:2},{value:"Start the websocket server",id:"start-the-websocket-server",level:3},{value:"Running in SuperVisor",id:"running-in-supervisor",level:4},{value:"Change broadcasting configuration",id:"change-broadcasting-configuration",level:3},{value:"Change frontend asset settings",id:"change-frontend-asset-settings",level:3},{value:"Rebuild assets &amp; restart services",id:"rebuild-assets--restart-services",level:3},{value:"Socketi",id:"socketi",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.admonition,{title:"Try pusher first",type:"info",children:(0,r.jsx)(s.p,{children:"It is recommended you keep running Pusher and switch to alternative methods only if Pusher free plan doesn't meet your needs."})}),"\n",(0,r.jsxs)(s.p,{children:["In the Getting Started section we setup ",(0,r.jsx)(s.a,{href:"https://pusher.com",children:"Pusher"})," as our websocket server."]}),"\n",(0,r.jsx)(s.p,{children:"Pusher free tier provides 200k push messages per day and 100 concurrent connections. This might not be enough when your audience is large. Ofcoz you can opt for paid plan of Pusher to remove these limitations but that might get costly."}),"\n",(0,r.jsx)(s.p,{children:"Here we are going to discuss about two self-hosted alternatives which won't have any limitations and support pusher protocol."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://beyondco.de/docs/laravel-websockets/",children:"Laravel Websockets"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://docs.soketi.app/",children:"Socketi"})}),"\n"]}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsx)(s.p,{children:"You need to install only of them in your server."})}),"\n",(0,r.jsx)(s.h2,{id:"laravel-websockets",children:"Laravel Websockets"}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsxs)(s.p,{children:["Visit Laravel Websocket docs for detailed explanation: ",(0,r.jsx)(s.a,{href:"https://beyondco.de/docs/laravel-websockets/",children:"https://beyondco.de/docs/laravel-websockets/"})]})}),"\n",(0,r.jsx)(s.p,{children:"Laravel Websockets server is already bundled with minetrax. To use it instead of pusher all you need to do is run the server and change your broadcasting configurations."}),"\n",(0,r.jsx)(s.h3,{id:"start-the-websocket-server",children:"Start the websocket server"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd /var/www/minetrax\r\nphp artisan websockets:serve\n"})}),"\n",(0,r.jsxs)(s.admonition,{type:"tip",children:[(0,r.jsx)(s.p,{children:"By default websocket server start on port 6001. You can change that by specifying port."}),(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"php artisan websockets:serve --port=3030\n"})})]}),"\n",(0,r.jsx)(s.h4,{id:"running-in-supervisor",children:"Running in SuperVisor"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"websockets:serve"})," should always be running to accept connection. This is why it is recommended to use supervisor to keep it running and automatically restart on crashes."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.em,{children:["Break the websocket server daemon by pressing ",(0,r.jsx)(s.code,{children:"Ctrl+C"})," if its running, and follow the steps below to use it with supervisor."]})}),"\n",(0,r.jsxs)(s.p,{children:["Create a new supervisor conf file in ",(0,r.jsx)(s.code,{children:"/etc/supervisor/conf.d"})," folder called ",(0,r.jsx)(s.code,{children:"minetrax-websocket.conf"})," and paste below content in there."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",metastring:'title="/etc/supervisor/conf.d/minetrax-websocket.conf"',children:"[program:minetrax-websockets]\r\ncommand=/usr/bin/php /var/www/minetrax/artisan websockets:serve\r\nnumprocs=1\r\nautostart=true\r\nautorestart=true\r\nuser=www-data\n"})}),"\n",(0,r.jsx)(s.p,{children:"Update the supervisor and start the daemon"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"supervisorctl update\r\nsupervisorctl start minetrax-websockets\n"})}),"\n",(0,r.jsx)(s.h3,{id:"change-broadcasting-configuration",children:"Change broadcasting configuration"}),"\n",(0,r.jsxs)(s.p,{children:["You need to add ",(0,r.jsx)(s.code,{children:"host"})," and ",(0,r.jsx)(s.code,{children:"port"})," config key in the ",(0,r.jsx)(s.code,{children:"config/broadcasting.php"})," and add it to the ",(0,r.jsx)(s.code,{children:"pusher"})," section. The default port of the Laravel WebSocket server is 6001"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-php",metastring:'title="config/broadcasting.php"',children:"'pusher' => [\r\n    'driver' => 'pusher',\r\n    'key' => env('PUSHER_APP_KEY'),\r\n    'secret' => env('PUSHER_APP_SECRET'),\r\n    'app_id' => env('PUSHER_APP_ID'),\r\n    'options' => [\r\n        'cluster' => env('PUSHER_APP_CLUSTER'),\r\n        'encrypted' => true,\r\n        'host' => '127.0.0.1',\r\n        'port' => 6001,\r\n        'scheme' => 'http'\r\n    ],\r\n],\r\n\n"})}),"\n",(0,r.jsx)(s.h3,{id:"change-frontend-asset-settings",children:"Change frontend asset settings"}),"\n",(0,r.jsxs)(s.p,{children:["Minetrax uses npm package called ",(0,r.jsx)(s.code,{children:"Echo"})," for listening to broadcasts.\r\nTo make Echo work with Laravel WebSockets, you need to make slight adjustments in ",(0,r.jsx)(s.code,{children:"resources/js/bootstrap.js"})," file."]}),"\n",(0,r.jsxs)(s.p,{children:["In Echo section of the file add ",(0,r.jsx)(s.code,{children:"wsHost"}),", ",(0,r.jsx)(s.code,{children:"wsPort"}),", ",(0,r.jsx)(s.code,{children:"disableStats"})," and ",(0,r.jsx)(s.code,{children:"forceTLS"})," as given below."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-js",children:"window.Echo = new Echo({\r\n    broadcaster: 'pusher',\r\n    key: 'your-pusher-key',\r\n    // highlight-start\r\n    wsHost: window.location.hostname,\r\n    wsPort: 6001,\r\n    forceTLS: false,\r\n    disableStats: true\r\n    // highlight-end\r\n});\n"})}),"\n",(0,r.jsx)(s.h3,{id:"rebuild-assets--restart-services",children:"Rebuild assets & restart services"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"cd /var/www/minetrax\r\n\r\nnpm install\r\nnpm run prod\r\n\r\nphp artisan queue:restart\r\nsupervisorctl restart minetrax-websockets\n"})}),"\n",(0,r.jsx)(s.admonition,{type:"tip",children:(0,r.jsxs)(s.p,{children:["For SSL support please read: ",(0,r.jsx)(s.a,{href:"https://beyondco.de/docs/laravel-websockets/basic-usage/ssl",children:"https://beyondco.de/docs/laravel-websockets/basic-usage/ssl"})]})}),"\n",(0,r.jsx)(s.h2,{id:"socketi",children:"Socketi"}),"\n",(0,r.jsx)(s.admonition,{type:"info",children:(0,r.jsxs)(s.p,{children:["Visit soketi docs for detailed explanation: ",(0,r.jsx)(s.a,{href:"https://docs.soketi.app/",children:"https://docs.soketi.app/"})]})}),"\n",(0,r.jsx)(s.admonition,{title:"Docs In Progress",type:"caution",children:(0,r.jsxs)(s.p,{children:["If you want to use Socketi, for now you can follow their official docs ",(0,r.jsx)(s.a,{href:"https://docs.soketi.app/getting-started/installation/cli-installation",children:"here"})]})})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>a});var t=n(6540);const r={},o=t.createContext(r);function i(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);